import"./modulepreload-polyfill-B5Qt9EMX.js";class c{constructor(t=null){this.value=t}}class o{constructor(){this.cells=Array(9).fill(null).map(()=>new c)}getCell(t,e){return this.cells[t*3+e]}setCell(t,e,i){this.cells[t*3+e].value=i}isFull(){return this.cells.every(t=>t.value!==null)}checkWinner(){const t=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const[e,i,s]of t)if(this.cells[e].value&&this.cells[e].value===this.cells[i].value&&this.cells[e].value===this.cells[s].value)return this.cells[e].value;return null}}class d{constructor(t=new o){this.board=t,this.currentPlayer="X",this.status="active",this.winner=null,this.moveHistory={X:Array(),O:Array()}}makeMove(t,e){if(this.board.getCell(t,e).value||this.status==="finished")return!1;if(this.board.setCell(t,e,this.currentPlayer),this.moveHistory[this.currentPlayer].push({row:t,col:e}),this.moveHistory[this.currentPlayer].length>3){const s=this.moveHistory[this.currentPlayer].shift();this.board.getCell(s.row,s.col).value===this.currentPlayer&&this.board.setCell(s.row,s.col,null)}return this.winner=this.board.checkWinner(),this.winner&&(this.status="finished"),this.currentPlayer=this.currentPlayer==="X"?"O":"X",!0}reset(){this.board=new o,this.currentPlayer="X",this.status="active",this.winner=null,this.moveHistory={X:[],O:[]}}getPlayerMoveHistory(t){return this.moveHistory[t]}}class a{constructor(){this.history=[],this.game=new d,this.statusEl=document.querySelector(".status"),this.boardEl=document.getElementById("board"),this.historyEl=document.getElementById("history"),this.toggleHistoryBtn=document.getElementById("toggleHistory"),this.resetBtn=document.getElementById("reset"),this.init()}init(){this.render(),this.boardEl.addEventListener("click",t=>this.handleCellClick(t)),this.resetBtn.addEventListener("click",()=>this.handleReset()),this.toggleHistoryBtn.addEventListener("click",()=>this.toggleHistory())}handleCellClick(t){const e=t.target;if(!e.classList.contains("cell"))return;const i=parseInt(e.dataset.row),s=parseInt(e.dataset.col);this.game.makeMove(i,s)&&(this.history.push({player:this.game.currentPlayer==="O"?"X":"O",move:[i,s],timestamp:Date.now()}),this.render())}handleReset(){this.game.reset(),this.history=[],this.render()}toggleHistory(){const t=this.historyEl.style.display==="none";this.historyEl.style.display=t?"block":"none",this.toggleHistoryBtn.textContent=t?"Скрыть историю":"Показать историю",this.renderHistory()}render(){const t=this.game.currentPlayer,e=this.game.getPlayerMoveHistory(t),i=e.length>=3?e[0]:null;for(let s=0;s<3;s++)for(let r=0;r<3;r++){const l=this.boardEl.querySelector(`[data-row="${s}"][data-col="${r}"]`),h=this.game.board.getCell(s,r).value;l.textContent=h??"",l.classList.remove("text-red-400","ring-2","ring-red-500","opacity-100","opacity-60"),l.classList.add("text-gray-100","opacity-90"),i&&i.row===s&&i.col===r?l.classList.add("text-red-400","ring-2","ring-red-500"):this.isInRecentMoves(s,r)?l.classList.add("opacity-100"):l.classList.add("opacity-60")}this.game.status==="finished"?this.statusEl.textContent=this.game.winner?`Победил: ${this.game.winner}!`:"Игра завершена":this.statusEl.textContent=`Ходит: ${t}`,this.renderHistory()}isInRecentMoves(t,e){return this.game.getPlayerMoveHistory(this.game.currentPlayer).some(s=>s.row===t&&s.col===e)}renderHistory(){if(this.historyEl.style.display!=="block")return;this.historyEl.innerHTML="";const t=document.createElement("h3");if(t.textContent="История ходов",this.historyEl.appendChild(t),this.history.length===0){this.historyEl.appendChild(document.createTextNode("История пуста."));return}const e=document.createElement("ol");this.history.forEach(i=>{const s=document.createElement("li");s.textContent=`Игрок ${i.player} походил на (${i.move[0]}, ${i.move[1]})`,e.appendChild(s)}),this.historyEl.appendChild(e)}}document.addEventListener("DOMContentLoaded",()=>{new a});document.addEventListener("DOMContentLoaded",()=>new a);
