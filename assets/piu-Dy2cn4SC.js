import"./modulepreload-polyfill-B5Qt9EMX.js";window.DOMHandler=class{constructor(y,l){this._iRuntime=y,this._componentId=l,this._hasTickCallback=!1,this._tickCallback=()=>this.Tick()}Attach(){}PostToRuntime(y,l,r,s){this._iRuntime.PostToRuntimeComponent(this._componentId,y,l,r,s)}PostToRuntimeAsync(y,l,r,s){return this._iRuntime.PostToRuntimeComponentAsync(this._componentId,y,l,r,s)}_PostToRuntimeMaybeSync(y,l,r){this._iRuntime.UsesWorker()?this.PostToRuntime(y,l,r):this._iRuntime._GetLocalRuntime()._OnMessageFromDOM({type:"event",component:this._componentId,handler:y,dispatchOpts:r||null,data:l,responseId:null})}AddRuntimeMessageHandler(y,l){this._iRuntime.AddRuntimeComponentMessageHandler(this._componentId,y,l)}AddRuntimeMessageHandlers(y){for(const[l,r]of y)this.AddRuntimeMessageHandler(l,r)}GetRuntimeInterface(){return this._iRuntime}GetComponentID(){return this._componentId}_StartTicking(){this._hasTickCallback||(this._iRuntime._AddRAFCallback(this._tickCallback),this._hasTickCallback=!0)}_StopTicking(){this._hasTickCallback&&(this._iRuntime._RemoveRAFCallback(this._tickCallback),this._hasTickCallback=!1)}Tick(){}},window.RateLimiter=class{constructor(y,l){this._callback=y,this._interval=l,this._timerId=-1,this._lastCallTime=-1/0,this._timerCallFunc=()=>this._OnTimer(),this._ignoreReset=!1,this._canRunImmediate=!1}SetCanRunImmediate(y){this._canRunImmediate=!!y}Call(){if(this._timerId===-1){const y=Date.now(),l=y-this._lastCallTime,r=this._interval;r<=l&&this._canRunImmediate?(this._lastCallTime=y,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(r-l,4))}}_RunCallback(){this._ignoreReset=!0,this._callback(),this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._lastCallTime=Date.now())}_OnTimer(){this._timerId=-1,this._lastCallTime=Date.now(),this._RunCallback()}_CancelTimer(){this._timerId!==-1&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer(),this._callback=null,this._timerCallFunc=null}};{class y{constructor(r){this._elem=r,this._hadFirstUpdate=!1,this._isVisibleFlag=!0,this._wantHtmlIndex=-1,this._actualHtmlIndex=-1,this._htmlZIndex=-1}SetVisibleFlag(r){this._isVisibleFlag=!!r}GetVisibleFlag(){return this._isVisibleFlag}HadFirstUpdate(){return this._hadFirstUpdate}SetHadFirstUpdate(){this._hadFirstUpdate=!0}GetWantHTMLIndex(){return this._wantHtmlIndex}SetWantHTMLIndex(r){this._wantHtmlIndex=r}GetActualHTMLIndex(){return this._actualHtmlIndex}SetActualHTMLIndex(r){this._actualHtmlIndex=r}SetHTMLZIndex(r){this._htmlZIndex=r}GetHTMLZIndex(){return this._htmlZIndex}GetElement(){return this._elem}}window.DOMElementHandler=class extends self.DOMHandler{constructor(l,r){super(l,r),this._elementMap=new Map,this._autoAttach=!0,this.AddRuntimeMessageHandlers([["create",s=>this._OnCreate(s)],["destroy",s=>this._OnDestroy(s)],["set-visible",s=>this._OnSetVisible(s)],["update-position",s=>this._OnUpdatePosition(s)],["update-state",s=>this._OnUpdateState(s)],["focus",s=>this._OnSetFocus(s)],["set-css-style",s=>this._OnSetCssStyle(s)],["set-attribute",s=>this._OnSetAttribute(s)],["remove-attribute",s=>this._OnRemoveAttribute(s)]]),this.AddDOMElementMessageHandler("get-element",s=>s)}SetAutoAttach(l){this._autoAttach=!!l}AddDOMElementMessageHandler(l,r){this.AddRuntimeMessageHandler(l,s=>{const c=s.elementId,p=this.GetElementById(c);return r(p,s)})}AddDOMElementMessageHandlers(l){for(const[r,s]of l)this.AddDOMElementMessageHandler(r,s)}_OnCreate(l){const r=l.elementId,s=this.CreateElement(r,l),c=new y(s),p=(this._elementMap.set(r,c),s.style.boxSizing="border-box",s.style.display="none",c.SetVisibleFlag(l.isVisible),this._GetFocusElement(s)),m=(p.addEventListener("focus",_=>this._OnFocus(r)),p.addEventListener("blur",_=>this._OnBlur(r)),l.htmlIndex);if(c.SetWantHTMLIndex(m),c.SetHTMLZIndex(l.htmlZIndex),this._autoAttach){const _=this.GetRuntimeInterface().GetAvailableHTMLIndex(m);(c.SetActualHTMLIndex(_),this.GetRuntimeInterface().GetHTMLWrapElement(_)).appendChild(s)}}CreateElement(l,r){throw new Error("required override")}DestroyElement(l){}_OnDestroy(l){const r=l.elementId,s=this.GetElementById(r);this.DestroyElement(s),this._autoAttach&&s.parentElement.removeChild(s),this._elementMap.delete(r)}PostToRuntimeElement(l,r,s){(s=s||{}).elementId=r,this.PostToRuntime(l,s)}_PostToRuntimeElementMaybeSync(l,r,s){(s=s||{}).elementId=r,this._PostToRuntimeMaybeSync(l,s)}_OnSetVisible(l){if(this._autoAttach){const r=this._elementMap.get(l.elementId),s=r.GetElement();r.HadFirstUpdate()?s.style.display=l.isVisible?"":"none":r.SetVisibleFlag(l.isVisible)}}_OnUpdatePosition(l){if(this._autoAttach){const r=this._elementMap.get(l.elementId),s=r.GetElement(),c=this.GetRuntimeInterface(),p=(s.style.left=l.left+"px",s.style.top=l.top+"px",s.style.width=l.width+"px",s.style.height=l.height+"px",l.fontSize),m=(p!==null&&(s.style.fontSize=p+"em"),l.htmlIndex),_=(r.SetWantHTMLIndex(m),c.GetAvailableHTMLIndex(m));_!==r.GetActualHTMLIndex()&&(s.remove(),c.GetHTMLWrapElement(_).appendChild(s),r.SetActualHTMLIndex(_),c._UpdateHTMLElementsZOrder());const v=l.htmlZIndex;v!==r.GetHTMLZIndex()&&(r.SetHTMLZIndex(v),c._UpdateHTMLElementsZOrder()),r.HadFirstUpdate()||(r.SetHadFirstUpdate(),r.GetVisibleFlag()&&(s.style.display=""))}}_OnHTMLLayersChanged(){if(this._autoAttach)for(const l of this._elementMap.values()){const r=this.GetRuntimeInterface().GetAvailableHTMLIndex(l.GetWantHTMLIndex()),s=l.GetActualHTMLIndex();if(r!==-1&&s!==-1&&r!==s){const c=l.GetElement();(c.remove(),this.GetRuntimeInterface().GetHTMLWrapElement(r)).appendChild(c),l.SetActualHTMLIndex(r)}}}_GetAllElementStatesForZOrderUpdate(){return this._autoAttach?[...this._elementMap.values()]:null}_OnUpdateState(l){const r=this.GetElementById(l.elementId);this.UpdateState(r,l)}UpdateState(l,r){throw new Error("required override")}_GetFocusElement(l){return l}_OnFocus(l){this.PostToRuntimeElement("elem-focused",l)}_OnBlur(l){this.PostToRuntimeElement("elem-blurred",l)}_OnSetFocus(l){const r=this._GetFocusElement(this.GetElementById(l.elementId));l.focus?r.focus():r.blur()}_OnSetCssStyle(l){const r=this.GetElementById(l.elementId),s=l.prop,c=l.val;s.startsWith("--")?r.style.setProperty(s,c):r.style[s]=c}_OnSetAttribute(l){this.GetElementById(l.elementId).setAttribute(l.name,l.val)}_OnRemoveAttribute(l){this.GetElementById(l.elementId).removeAttribute(l.name)}GetElementById(l){const r=this._elementMap.get(l);if(r)return r.GetElement();throw new Error("no element with id "+l)}}}{let c=function(n){const e=document.createElement("script");return e.async=!1,e.type="module",n.isStringSrc?new Promise(i=>{const a="c3_resolve_"+s;++s,self[a]=i,e.textContent=n.str+`

self["${a}"]();`,document.head.appendChild(e)}):new Promise((i,a)=>{e.onload=i,e.onerror=a,e.src=n,document.head.appendChild(e)})},M=function(n){return new Promise((e,i)=>{const a=new FileReader;a.onload=o=>e(o.target.result),a.onerror=o=>i(o),a.readAsArrayBuffer(n)})},L=function(n){return H.has(n)};const y=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),l=/android/i.test(navigator.userAgent),r=/safari/i.test(navigator.userAgent)&&!/(chrome|chromium|edg\/|OPR\/|nwjs)/i.test(navigator.userAgent);let s=0;async function p(){if(!navigator.userActivation||typeof OffscreenCanvas>"u")return!1;try{let n=!1;const e=new Blob([`
	self.addEventListener("message", () =>
	{
		try {
			const offscreenCanvas = new OffscreenCanvas(32, 32);
			const gl = offscreenCanvas.getContext("webgl");
			self.postMessage(!!gl);
		}
		catch (err)
		{
			console.warn("Feature detection worker error:", err);
			self.postMessage(false);
		}
	});`],{type:"text/javascript"}),i=new Worker(URL.createObjectURL(e),{get type(){n=!0}}),a=await new Promise(o=>{i.addEventListener("message",d=>{i.terminate(),o(d.data)}),i.postMessage("")});return n&&a}catch(n){return console.warn("Error feature detecting worker mode: ",n),!1}}let m=new Audio;const _={"audio/webm; codecs=opus":!!m.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!m.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!m.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!m.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!m.canPlayType("audio/mp4"),"audio/mpeg":!!m.canPlayType("audio/mpeg")};async function v(n){const e=await M(n);return new TextDecoder("utf-8").decode(e)}m=null;const C=[];let O=0;const k=8,f=(window.RealFile=window.File,[]),E=new Map,S=new Map;let P=0;const A=[],H=(self.runOnStartup=function(n){if(typeof n!="function")throw new Error("runOnStartup called without a function");A.push(n)},new Set(["cordova","playable-ad-single-file","playable-ad-zip","instant-games"]));let t=!1;window.RuntimeInterface=class W{constructor(e){if(this._useWorker=e.useWorker,this._messageChannelPort=null,this._runtimeBaseUrl="",this._scriptFolder=e.scriptFolder,this._worker=null,this._localRuntime=null,this._domHandlers=[],this._runtimeDomHandler=null,this._isFirstSizeUpdate=!0,this._canvasLayers=[],this._pendingRemoveElements=[],this._pendingUpdateHTMLZOrder=!1,this._updateHTMLZOrderRAFCallback=()=>this._DoUpdateHTMLElementsZOrder(),this._isExportingToVideo=!1,this._exportToVideoDuration=0,this._jobScheduler=null,this._rafId=-1,this._rafFunc=()=>this._OnRAFCallback(),this._rafCallbacks=new Set,this._wrapperInitResolve=null,this._wrapperComponentIds=[],this._exportType=e.exportType,this._isFileProtocol=location.protocol.substr(0,4)==="file",this._directoryHandles=[],this._exportType!=="playable-ad-single-file"&&this._exportType!=="playable-ad-zip"&&this._exportType!=="instant-games"||(this._useWorker=!1),r&&(this._useWorker=!1),this._exportType==="cordova"&&this._useWorker&&l){const i=/Chrome\/(\d+)/i.exec(navigator.userAgent);i&&90<=parseInt(i[1],10)||(this._useWorker=!1)}this.IsAnyWebView2Wrapper()?self.chrome.webview.addEventListener("message",i=>this._OnWrapperMessage(i.data,i.additionalObjects)):this._exportType==="macos-wkwebview"?self.C3WrapperOnMessage=i=>this._OnWrapperMessage(JSON.parse(i)):this._exportType==="linux-cef"&&self.c3_linux_cef_set_message_callback(i=>this._OnWrapperMessage(JSON.parse(i))),this._localFileBlobs=null,this._localFileStrings=null,this._exportType!=="html5"||window.isSecureContext||console.warn("[Construct] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available."),this.AddRuntimeComponentMessageHandler("canvas","update-size",i=>this._OnUpdateCanvasSize(i)),this.AddRuntimeComponentMessageHandler("canvas","set-html-layer-count",i=>this._OnSetHTMLLayerCount(i)),this.AddRuntimeComponentMessageHandler("canvas","cleanup-html-layers",()=>this._OnCleanUpHTMLLayers()),this.AddRuntimeComponentMessageHandler("canvas","update-html-layer-dom-state",i=>this._UpdateHTMLLayerDOMProperties(i.layersDomState)),this.AddRuntimeComponentMessageHandler("runtime","cordova-fetch-local-file",i=>this._OnCordovaFetchLocalFile(i)),this.AddRuntimeComponentMessageHandler("runtime","create-job-worker",i=>this._OnCreateJobWorker(i)),this.AddRuntimeComponentMessageHandler("runtime","send-wrapper-extension-message",i=>this._OnSendWrapperExtensionMessage(i)),this._exportType==="cordova"?document.addEventListener("deviceready",()=>this._Init(e)):this._Init(e),this._skipAndroidVirtualKeyboardDetection=0}Release(){this._CancelAnimationFrame(),this._messageChannelPort&&(this._messageChannelPort.onmessage=null,this._messageChannelPort=null),this._worker&&(this._worker.terminate(),this._worker=null),this._localRuntime&&(this._localRuntime.Release(),this._localRuntime=null);for(const{canvas:e,htmlWrap:i}of this._canvasLayers)e.remove(),i.remove();this._canvasLayers.length=0}GetMainCanvas(){return this._canvasLayers[0].canvas}GetAvailableHTMLIndex(e){return Math.min(e,this._canvasLayers.length-1)}GetHTMLWrapElement(e){if(e<0||e>=this._canvasLayers.length)throw new RangeError("invalid canvas layer");return this._canvasLayers[e].htmlWrap}_GetHTMLWrapElement(e){return this.GetHTMLWrapElement(e)}GetRuntimeBaseURL(){return this._runtimeBaseUrl}UsesWorker(){return this._useWorker}GetExportType(){return this._exportType}IsFileProtocol(){return this._isFileProtocol}GetScriptFolder(){return this._scriptFolder}IsiOSCordova(){return y&&this._exportType==="cordova"}IsiOSWebView(){const e=navigator.userAgent;return y&&L(this._exportType)||navigator.standalone||/crios\/|fxios\/|edgios\//i.test(e)}IsAndroid(){return l}IsAndroidWebView(){return l&&L(this._exportType)}IsWindowsWebView2(){return this._exportType==="windows-webview2"||!!(this._exportType==="preview"&&window.chrome&&window.chrome.webview&&window.chrome.webview.postMessage)}IsAnyWebView2Wrapper(){return this.IsWindowsWebView2()||this._exportType==="xbox-uwp-webview2"}SkipNextAndroidVirtualKeyboardDetection(){this.IsAndroidWebView()&&this._skipAndroidVirtualKeyboardDetection++}CanDoAndroidVirtualKeyboardDetection(){return this._CanDoAndroidVirtualKeyboardDetection().next().value}*_CanDoAndroidVirtualKeyboardDetection(){if(!this.IsAndroidWebView())return!0;yield this._skipAndroidVirtualKeyboardDetection===0,0<this._skipAndroidVirtualKeyboardDetection&&this._skipAndroidVirtualKeyboardDetection--}async _Init(e){if(this._useWorker&&(await p()||(this._useWorker=!1)),this._exportType==="macos-wkwebview"&&this._SendWrapperMessage({type:"ready"}),this.IsAnyWebView2Wrapper()||this._exportType==="macos-wkwebview"||this._exportType==="linux-cef"){this._SetupDesktopWrapperPolyfills();const a=await this._InitWrapper();this._wrapperComponentIds=a.registeredComponentIds}if(this._exportType==="playable-ad-single-file"&&(this._localFileBlobs=self.c3_base64files,this._localFileStrings={},await this._ConvertDataUrisToBlobs()),this._exportType==="nwjs"&&self.nw&&(self.nw.Window.get().on("close",()=>self.nw.App.quit()),self.nw.App.manifest["c3-steam-mode"])){let o=0;this._AddRAFCallback(()=>{o++,document.documentElement.style.opacity=o%2==0?"1":"0.999"})}if(e.runtimeBaseUrl)this._runtimeBaseUrl=e.runtimeBaseUrl;else{const a=location.origin,o=(this._runtimeBaseUrl=(a==="null"?"file:///":a)+location.pathname,this._runtimeBaseUrl.lastIndexOf("/"));o!==-1&&(this._runtimeBaseUrl=this._runtimeBaseUrl.substr(0,o+1))}const i=new MessageChannel;if(this._messageChannelPort=i.port1,this._messageChannelPort.onmessage=a=>this._OnMessageFromRuntime(a.data),window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(a=>this._OnMessageFromDebugger(a)),this._jobScheduler=new self.JobSchedulerDOM(this),await this._jobScheduler.Init(),typeof window.StatusBar=="object"&&window.StatusBar.hide(),typeof window.AndroidFullScreen=="object")try{await new Promise((a,o)=>{window.AndroidFullScreen.immersiveMode(a,o)})}catch(a){console.error("Failed to enter Android immersive mode: ",a)}this._useWorker?await this._InitWorker(e,i.port2):await this._InitDOM(e,i.port2)}_GetCommonRuntimeOptions(e){return{runtimeBaseUrl:this._runtimeBaseUrl,previewUrl:location.href,windowInnerWidth:this._GetWindowInnerWidth(),windowInnerHeight:this._GetWindowInnerHeight(),cssDisplayMode:this.GetCssDisplayMode(),devicePixelRatio:window.devicePixelRatio,isFullscreen:W.IsDocumentFullscreen(),swClientId:window.cr_swClientId||"",exportType:e.exportType,isNWjs:typeof nw<"u",fileMap:globalThis.c3_swFileMap??new Map(Object.entries(this._localFileBlobs??{})),scriptFolder:this._scriptFolder,isDebug:new URLSearchParams(self.location.search).has("debug"),ife:!!self.ife,jobScheduler:this._jobScheduler.GetPortData(),supportedAudioFormats:_,isFileProtocol:this._isFileProtocol,isiOSCordova:this.IsiOSCordova(),isiOSWebView:this.IsiOSWebView(),isWindowsWebView2:this.IsWindowsWebView2(),isAnyWebView2Wrapper:this.IsAnyWebView2Wrapper(),wrapperComponentIds:this._wrapperComponentIds,isFBInstantAvailable:self.FBInstant!==void 0}}async _InitWorker(e,i){const a=e.workerMainUrl,o=(this._exportType==="preview"?(this._worker=new Worker("previewworker.js",{type:"module",name:"Runtime"}),await new Promise((u,w)=>{const g=I=>{this._worker.removeEventListener("message",g),(I.data&&I.data.type==="ok"?u:w)()};this._worker.addEventListener("message",g),this._worker.postMessage({type:"construct-worker-init",import:new URL(a,this._runtimeBaseUrl).toString()})})):this._worker=await this.CreateWorker(a,{type:"module",name:"Runtime"}),document.createElement("canvas")),d=(o.style.display="none",o.transferControlToOffscreen()),h=(document.body.appendChild(o),document.createElement("div"));h.className="c3htmlwrap",h.setAttribute("interactive",""),document.body.appendChild(h),this._canvasLayers.push({canvas:o,htmlWrap:h,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}}),window.c3canvas=o,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this._worker.postMessage(Object.assign(this._GetCommonRuntimeOptions(e),{type:"init-runtime",isInWorker:!0,messagePort:i,canvas:d,runtimeScriptList:e.runtimeScriptList,projectMainScriptPath:e.projectMainScriptPath,scriptsInEventsPath:e.scriptsInEventsPath}),[i,d,...this._jobScheduler.GetPortTransferables()]),this._domHandlers=f.map(u=>new u(this)),this._FindRuntimeDOMHandler(),this._runtimeDomHandler._AddDefaultCanvasEventHandlers(o),this._runtimeDomHandler._AddDefaultHTMLWrapEventHandlers(h),this._runtimeDomHandler._EnableWindowResizeEvent(),self.c3_callFunction=(u,w)=>this._runtimeDomHandler._InvokeFunctionFromJS(u,w),this._exportType==="preview"&&(self.goToLastErrorScript=()=>this.PostToRuntimeComponent("runtime","go-to-last-error-script"))}async _InitDOM(e,i){const a=document.createElement("canvas"),o=(a.style.display="none",document.body.appendChild(a),document.createElement("div")),d=(o.className="c3htmlwrap",o.setAttribute("interactive",""),document.body.appendChild(o),this._canvasLayers.push({canvas:a,htmlWrap:o,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}}),window.c3canvas=a,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this._domHandlers=f.map(g=>new g(this)),this._FindRuntimeDOMHandler(),this._runtimeDomHandler._AddDefaultCanvasEventHandlers(a),this._runtimeDomHandler._AddDefaultHTMLWrapEventHandlers(o),await Promise.all(e.runtimeScriptList.map(g=>this._MaybeGetPlatformSpecificScriptURL(g)))),h=(await Promise.all(d.map(g=>c(g))),e.projectMainScriptPath),u=e.scriptsInEventsPath;if(h)try{if(await c(h),this._exportType==="preview"&&!globalThis.C3_ProjectMainScriptOK)throw new Error("main script did not run to completion")}catch(g){this._RemoveLoadingMessage(),console.error("Error loading project main script: ",g),alert(`Failed to load the project main script (${h}). Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the script. Press F12 and check the console for error details.`)}if(u)try{if(await c(u),this._exportType==="preview"&&!globalThis.C3.ScriptsInEvents)throw new Error("scripts in events did not run to completion")}catch(g){this._RemoveLoadingMessage(),console.error("Error loading scripts in events: ",g),alert("Failed to load scripts in events. Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}const w=Object.assign(this._GetCommonRuntimeOptions(e),{isInWorker:!1,messagePort:i,canvas:a,runOnStartupFunctions:A});this._runtimeDomHandler._EnableWindowResizeEvent(),this._OnBeforeCreateRuntime(),this._localRuntime=self.C3_CreateRuntime(w),await self.C3_InitRuntime(this._localRuntime,w)}async CreateWorker(e,i){if(e.startsWith("blob:"))return new Worker(e,i);if(this._exportType==="cordova"&&this._isFileProtocol){const d=await this.CordovaFetchLocalFileAsArrayBuffer(e),h=new Blob([d],{type:"application/javascript"});return new Worker(URL.createObjectURL(h),i)}if(this._exportType==="playable-ad-single-file"){const d=this._localFileBlobs[e];if(d)return new Worker(URL.createObjectURL(d),i);throw new Error("missing script: "+e)}const a=new URL(e,location.href);if(location.origin!==a.origin){const d=await fetch(a);if(!d.ok)throw new Error("failed to fetch worker script");const h=await d.blob();return new Worker(URL.createObjectURL(h),i)}return new Worker(a,i)}_GetWindowInnerWidth(){return Math.max(window.innerWidth,1)}_GetWindowInnerHeight(){return Math.max(window.innerHeight,1)}GetCssDisplayMode(){if(this.IsAnyWebView2Wrapper())return"standalone";const e=this.GetExportType();return new Set(["cordova","nwjs","macos-wkwebview","linux-cef"]).has(e)?"standalone":window.matchMedia("(display-mode: fullscreen)").matches?"fullscreen":window.matchMedia("(display-mode: standalone)").matches?"standalone":window.matchMedia("(display-mode: minimal-ui)").matches?"minimal-ui":navigator.standalone?"standalone":"browser"}_OnBeforeCreateRuntime(){this._RemoveLoadingMessage()}_RemoveLoadingMessage(){const e=window.cr_previewLoadingElem;e&&(e.parentElement.removeChild(e),window.cr_previewLoadingElem=null)}async _OnCreateJobWorker(e){const i=await this._jobScheduler._CreateJobWorker();return{outputPort:i,transferables:[i]}}_OnUpdateCanvasSize(e){if(!this.IsExportingToVideo()){const i=e.styleWidth+"px",a=e.styleHeight+"px",o=e.marginLeft+"px",d=e.marginTop+"px";for(const{canvas:h,htmlWrap:u}of this._canvasLayers)h.style.width=i,h.style.height=a,h.style.marginLeft=o,h.style.marginTop=d,u.style.width=i,u.style.height=a,u.style.marginLeft=o,u.style.marginTop=d,this._isFirstSizeUpdate&&(h.style.display="",u.style.display="");document.documentElement.style.setProperty("--construct-scale",e.displayScale),this._isFirstSizeUpdate=!1}}_OnSetHTMLLayerCount(e){const i=e.count,a=e.layersDomState,o=e.immediate,d=e.styleWidth+"px",h=e.styleHeight+"px",u=e.marginLeft+"px",w=e.marginTop+"px",g=[],I=[];if(i<this._canvasLayers.length)for(;this._canvasLayers.length>i;){const{canvas:b,htmlWrap:x}=this._canvasLayers.pop();x.remove(),this._useWorker&&!o?this._pendingRemoveElements.push(b):b.remove()}else if(i>this._canvasLayers.length)for(let b=0,x=i-this._canvasLayers.length;b<x;++b){const R=document.createElement("canvas");if(R.classList.add("c3overlay"),this._useWorker){const F=R.transferControlToOffscreen();g.push(F),I.push(F)}else g.push(R);document.body.appendChild(R);const T=document.createElement("div");T.classList.add("c3htmlwrap","c3overlay"),T.setAttribute("interactive",""),document.body.appendChild(T),R.style.width=d,R.style.height=h,R.style.marginLeft=u,R.style.marginTop=w,T.style.width=d,T.style.height=h,T.style.marginLeft=u,T.style.marginTop=w,this._runtimeDomHandler._AddDefaultCanvasEventHandlers(R),this._runtimeDomHandler._AddDefaultHTMLWrapEventHandlers(T),this._canvasLayers.push({canvas:R,htmlWrap:T,lastHtmlLayerDomState:{isVisible:!0,opacity:1,isInteractive:!0}})}this._UpdateHTMLLayerDOMProperties(a);for(const b of this._domHandlers)b instanceof window.DOMElementHandler&&b._OnHTMLLayersChanged();return this._UpdateHTMLElementsZOrder(),{addedCanvases:g,transferables:I}}_UpdateHTMLLayerDOMProperties(e){for(let i=0,a=Math.min(this._canvasLayers.length,e.length);i<a;++i){const{htmlWrap:o,lastHtmlLayerDomState:d}=this._canvasLayers[i],h=e[i],u=h.isVisible,w=h.opacity,g=h.isInteractive;u!==d.isVisible&&(o.style.display=u?"":"none",d.isVisible=u),w!==d.opacity&&(o.style.opacity=w===1?"":String(w),d.opacity=w),g!==d.isInteractive&&(o.style.pointerEvents=g?"":"none",g?o.setAttribute("interactive",""):o.removeAttribute("interactive"),d.isInteractive=g)}}_OnCleanUpHTMLLayers(){for(const e of this._pendingRemoveElements)e.remove();this._pendingRemoveElements.length=0}_UpdateHTMLElementsZOrder(){this._pendingUpdateHTMLZOrder||(this._pendingUpdateHTMLZOrder=!0,this._AddRAFCallback(this._updateHTMLZOrderRAFCallback))}_DoUpdateHTMLElementsZOrder(){this._RemoveRAFCallback(this._updateHTMLZOrderRAFCallback),this._pendingUpdateHTMLZOrder=!1;let e=[];for(const h of this._domHandlers)if(h instanceof window.DOMElementHandler){const u=h._GetAllElementStatesForZOrderUpdate();u&&e.push(...u)}e.sort((h,u)=>{const w=h.GetActualHTMLIndex(),g=u.GetActualHTMLIndex();if(w!==g)return w-g;const I=h.GetHTMLZIndex(),b=u.GetHTMLZIndex();return I-b});let i=0,a=0,o=0,d=e.length;for(;o<d;++o){const h=e[o];h.GetActualHTMLIndex()!==i&&(this._DoUpdateHTMLElementsZOrderOnHTMLLayer(i,e.slice(a,o)),i=h.GetActualHTMLIndex(),a=o)}a<o&&this._DoUpdateHTMLElementsZOrderOnHTMLLayer(i,e.slice(a,o))}_DoUpdateHTMLElementsZOrderOnHTMLLayer(e,i){if(!(i.length<=1||e>=this._canvasLayers.length)){const a=i.map(u=>u.GetElement()),o=new Set(a),d=this.GetHTMLWrapElement(e),h=Array.from(d.children).filter(u=>o.has(u));for(let u=0,w=0,g=a.length;u<g;++u){const I=a[u],b=h[w];I===b?++w:d.insertBefore(I,b)}}}_GetLocalRuntime(){if(this._useWorker)throw new Error("not available in worker mode");return this._localRuntime}PostToRuntimeComponent(e,i,a,o,d){this._messageChannelPort.postMessage({type:"event",component:e,handler:i,dispatchOpts:o||null,data:a,responseId:null},d)}PostToRuntimeComponentAsync(e,i,a,o,d){const h=P++,u=new Promise((w,g)=>{S.set(h,{resolve:w,reject:g})});return this._messageChannelPort.postMessage({type:"event",component:e,handler:i,dispatchOpts:o||null,data:a,responseId:h},d),u}_OnMessageFromRuntime(e){const i=e.type;if(i==="event")return this._OnEventFromRuntime(e);if(i==="result")this._OnResultFromRuntime(e);else if(i==="runtime-ready")this._OnRuntimeReady();else if(i==="alert-error")this._RemoveLoadingMessage(),alert(e.message);else{if(i!=="creating-runtime")throw new Error(`unknown message '${i}'`);this._OnBeforeCreateRuntime()}}_OnEventFromRuntime(e){const i=e.component,a=e.handler,o=e.data,d=e.responseId,h=E.get(i);if(h){const u=h.get(a);if(u){let w=null;try{w=u(o)}catch(g){return console.error(`Exception in '${i}' handler '${a}':`,g),void(d!==null&&this._PostResultToRuntime(d,!1,""+g))}if(d===null)return w;w&&w.then?w.then(g=>this._PostResultToRuntime(d,!0,g)).catch(g=>{console.error(`Rejection from '${i}' handler '${a}':`,g),this._PostResultToRuntime(d,!1,""+g)}):this._PostResultToRuntime(d,!0,w)}else console.warn(`[DOM] No handler '${a}' for component '${i}'`)}else console.warn(`[DOM] No event handlers for component '${i}'`)}_PostResultToRuntime(e,i,a){let o;a&&a.transferables&&(o=a.transferables),this._messageChannelPort.postMessage({type:"result",responseId:e,isOk:i,result:a},o)}_OnResultFromRuntime(e){const i=e.responseId,a=e.isOk,o=e.result,d=S.get(i);a?d.resolve(o):d.reject(o),S.delete(i)}AddRuntimeComponentMessageHandler(e,i,a){let o=E.get(e);if(o||(o=new Map,E.set(e,o)),o.has(i))throw new Error(`[DOM] Component '${e}' already has handler '${i}'`);o.set(i,a)}static AddDOMHandlerClass(e){if(f.includes(e))throw new Error("DOM handler already added");f.push(e)}_FindRuntimeDOMHandler(){for(const e of this._domHandlers)if(e.GetComponentID()==="runtime")return void(this._runtimeDomHandler=e);throw new Error("cannot find runtime DOM handler")}_OnMessageFromDebugger(e){this.PostToRuntimeComponent("debugger","message",e)}_OnRuntimeReady(){for(const e of this._domHandlers)e.Attach()}static IsDocumentFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||t)}static _SetWrapperIsFullscreenFlag(e){t=!!e}async GetRemotePreviewStatusInfo(){return this.PostToRuntimeComponentAsync("runtime","get-remote-preview-status-info")}_AddRAFCallback(e){this._rafCallbacks.add(e),this._RequestAnimationFrame()}_RemoveRAFCallback(e){this._rafCallbacks.delete(e),this._rafCallbacks.size===0&&this._CancelAnimationFrame()}_RequestAnimationFrame(){this._rafId===-1&&0<this._rafCallbacks.size&&(this._rafId=requestAnimationFrame(this._rafFunc))}_CancelAnimationFrame(){this._rafId!==-1&&(cancelAnimationFrame(this._rafId),this._rafId=-1)}_OnRAFCallback(){this._rafId=-1;for(const e of this._rafCallbacks)e();this._RequestAnimationFrame()}TryPlayMedia(e){this._runtimeDomHandler.TryPlayMedia(e)}RemovePendingPlay(e){this._runtimeDomHandler.RemovePendingPlay(e)}_PlayPendingMedia(){this._runtimeDomHandler._PlayPendingMedia()}SetSilent(e){this._runtimeDomHandler.SetSilent(e)}IsAudioFormatSupported(e){return!!_[e]}SetIsExportingToVideo(e){this._isExportingToVideo=!0,this._exportToVideoDuration=e}IsExportingToVideo(){return this._isExportingToVideo}GetExportToVideoDuration(){return this._exportToVideoDuration}IsAbsoluteURL(e){return/^(?:[a-z\-]+:)?\/\//.test(e)||e.substr(0,5)==="data:"||e.substr(0,5)==="blob:"}IsRelativeURL(e){return!this.IsAbsoluteURL(e)}async _MaybeGetPlatformSpecificScriptURL(e){if(this._exportType==="cordova"&&(e.startsWith("file:")||this._isFileProtocol&&this.IsRelativeURL(e))){let i=e;i.startsWith(this._runtimeBaseUrl)&&(i=i.substr(this._runtimeBaseUrl.length));const a=await this.CordovaFetchLocalFileAsArrayBuffer(i),o=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(o)}if(this._exportType!=="playable-ad-single-file")return e;if(this._localFileStrings.hasOwnProperty(e))return{isStringSrc:!0,str:this._localFileStrings[e]};if(this._localFileBlobs.hasOwnProperty(e))return URL.createObjectURL(this._localFileBlobs[e]);throw new Error("missing script: "+e)}async _OnCordovaFetchLocalFile(e){const i=e.filename;switch(e.as){case"text":return this.CordovaFetchLocalFileAsText(i);case"buffer":return this.CordovaFetchLocalFileAsArrayBuffer(i);default:throw new Error("unsupported type")}}CordovaFetchLocalFile(e){const i=window.cordova.file.applicationDirectory+"www/"+e;return new Promise((a,o)=>{window.resolveLocalFileSystemURL(i,d=>{d.file(a,o)},o)})}async CordovaFetchLocalFileAsText(e){const i=await this.CordovaFetchLocalFile(e);return v(i)}_CordovaMaybeStartNextArrayBufferRead(){if(C.length&&!(O>=k)){O++;const e=C.shift();this._CordovaDoFetchLocalFileAsAsArrayBuffer(e.filename,e.successCallback,e.errorCallback)}}CordovaFetchLocalFileAsArrayBuffer(e){return new Promise((i,a)=>{C.push({filename:e,successCallback:o=>{O--,this._CordovaMaybeStartNextArrayBufferRead(),i(o)},errorCallback:o=>{O--,this._CordovaMaybeStartNextArrayBufferRead(),a(o)}}),this._CordovaMaybeStartNextArrayBufferRead()})}async _CordovaDoFetchLocalFileAsAsArrayBuffer(e,i,a){try{const o=await this.CordovaFetchLocalFile(e),d=await M(o);i(d)}catch(o){a(o)}}_PlayableAdFetchBlob(e){if(this._localFileBlobs.hasOwnProperty(e))return this._localFileBlobs[e];throw new Error("missing file: "+e)}_GetPermissionAPI(){const e=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;if(typeof e!="object")throw new Error("Permission API is not loaded");return e}_MapPermissionID(e,i){const a=e[i];if(typeof a!="string")throw new Error("Invalid permission name");return a}_HasPermission(e){const i=this._GetPermissionAPI();return new Promise((a,o)=>i.checkPermission(this._MapPermissionID(i,e),d=>a(!!d.hasPermission),o))}_RequestPermission(e){const i=this._GetPermissionAPI();return new Promise((a,o)=>i.requestPermission(this._MapPermissionID(i,e),d=>a(!!d.hasPermission),o))}async RequestPermissions(e){if(this.GetExportType()==="cordova"&&!this.IsiOSCordova()){for(const i of e)if(!await this._HasPermission(i)&&await this._RequestPermission(i)===!1)return!1}return!0}async RequirePermissions(...e){if(await this.RequestPermissions(e)===!1)throw new Error("Permission not granted")}_OnWrapperMessage(e,i){if(typeof e=="object"&&e){const a=e.type;if(a==="directory-handles")this._directoryHandles=i;else if(a==="wrapper-init-response")this._wrapperInitResolve(e),this._wrapperInitResolve=null;else if(a==="fullscreen-change")W._SetWrapperIsFullscreenFlag(e.isFullscreen),this._runtimeDomHandler._OnFullscreenChange();else if(a==="log-to-console")switch(e.logType){case"error":console.error(e.message);break;case"warning":console.warn(e.message);break;default:console.log(e.message)}else a==="extension-message"?this.PostToRuntimeComponent("runtime","wrapper-extension-message",e):console.warn("Unknown wrapper message: ",e)}else console.warn("Unknown wrapper message: ",e)}_OnSendWrapperExtensionMessage(e){this._SendWrapperMessage({type:"extension-message",componentId:e.componentId,messageId:e.messageId,params:e.params||[],asyncId:e.asyncId})}_SendWrapperMessage(e){this.IsAnyWebView2Wrapper()?window.chrome.webview.postMessage(JSON.stringify(e)):this._exportType==="macos-wkwebview"?window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(e)):this._exportType==="linux-cef"&&window.c3_linux_cef_sendmessage(JSON.stringify(e))}_SetupDesktopWrapperPolyfills(){window.moveTo=(e,i)=>{this._SendWrapperMessage({type:"set-window-position",windowX:Math.ceil(e),windowY:Math.ceil(i)})},window.resizeTo=(e,i)=>{this._SendWrapperMessage({type:"set-window-size",windowWidth:Math.ceil(e),windowHeight:Math.ceil(i)})}}_InitWrapper(){return new Promise(e=>{this._wrapperInitResolve=e,this._SendWrapperMessage({type:"wrapper-init"})})}_GetDirectoryHandles(){return this._directoryHandles}async _ConvertDataUrisToBlobs(){const e=[];for(const[i,a]of Object.entries(this._localFileBlobs))e.push(this._ConvertDataUriToBlobs(i,a));await Promise.all(e)}async _ConvertDataUriToBlobs(e,i){if(typeof i=="object")this._localFileBlobs[e]=new Blob([i.str],{type:i.type}),this._localFileStrings[e]=i.str;else{let a=await this._FetchDataUri(i);a=a||this._DataURIToBinaryBlobSync(i),this._localFileBlobs[e]=a}}async _FetchDataUri(e){try{return await(await fetch(e)).blob()}catch(i){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",i),null}}_DataURIToBinaryBlobSync(e){const i=this._ParseDataURI(e);return this._BinaryStringToBlob(i.data,i.mime_type)}_ParseDataURI(e){const i=e.indexOf(",");if(i<0)throw new URIError("expected comma in data: uri");const a=e.substring(5,i),o=e.substring(i+1),d=a.split(";"),h=d[0]||"",u=d[1],w=d[2];return{mime_type:h,data:(u==="base64"||w==="base64"?atob:decodeURIComponent)(o)}}_BinaryStringToBlob(e,i){let a=e.length,o=a>>2,d=new Uint8Array(a),h=new Uint32Array(d.buffer,0,o),u,w;for(u=0,w=0;u<o;++u)h[u]=e.charCodeAt(w++)|e.charCodeAt(w++)<<8|e.charCodeAt(w++)<<16|e.charCodeAt(w++)<<24;let g=3&a;for(;g--;)d[w]=e.charCodeAt(w),++w;return new Blob([d],{type:i})}}}{let l=function(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents},m=function(t){return new Promise((n,e)=>{const i=document.createElement("link");i.onload=()=>n(i),i.onerror=a=>e(a),i.rel="stylesheet",i.href=t,document.head.appendChild(i)})},_=function(t){return new Promise((n,e)=>{const i=new Image;i.onload=()=>n(i),i.onerror=a=>e(a),i.src=t})},M=function(t){do if(t.parentNode&&t.hasAttribute("contenteditable"))return!0;while(t=t.parentNode);return!1},O=function(t){return C.has(t.tagName.toLowerCase())||M(t)},f=function(t){if(t.target.tagName){const n=t.target.tagName.toLowerCase();k.has(n)&&t.preventDefault()}},E=function(t){t.target.tagName&&t.target.classList.contains("c3htmlwrap")&&t.preventDefault()},S=function(t){(t.metaKey||t.ctrlKey)&&t.preventDefault()},A=function(){try{return window.parent&&window.parent.document.hasFocus()}catch{return!1}};const y=self.RuntimeInterface,r=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),s={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},c={dispatchUserScriptEvent:!0},p={dispatchRuntimeEvent:!0};async function v(t){const n=URL.createObjectURL(t);try{return await _(n)}finally{URL.revokeObjectURL(n)}}const C=new Set(["input","textarea","datalist","select"]),k=new Set(["canvas","body","html"]);self.C3_GetSvgImageSize=async function(t){const n=await v(t);if(0<n.width&&0<n.height)return[n.width,n.height];{n.style.position="absolute",n.style.left="0px",n.style.top="0px",n.style.visibility="hidden",document.body.appendChild(n);const e=n.getBoundingClientRect();return document.body.removeChild(n),[e.width,e.height]}};let P=!(self.C3_RasterSvgImageBlob=async function(t,n,e,i,a){const o=await v(t),d=document.createElement("canvas");return(d.width=i,d.height=a,d.getContext("2d")).drawImage(o,0,0,n,e),d});document.addEventListener("pause",()=>P=!0),document.addEventListener("resume",()=>P=!1);const H="runtime",L=class extends self.DOMHandler{constructor(t){super(t,H),this._enableWindowResizeEvent=!1,this._simulatedResizeTimerId=-1,this._targetOrientation="any",this._attachedDeviceOrientationEvent=!1,this._attachedDeviceMotionEvent=!1,this._pageVisibilityIsHidden=!1,this._screenReaderTextWrap=document.createElement("div"),this._screenReaderTextWrap.className="c3-screen-reader-text",this._screenReaderTextWrap.setAttribute("aria-live","polite"),document.body.appendChild(this._screenReaderTextWrap),this._debugHighlightElem=null,this._isExportToVideo=!1,this._exportVideoProgressMessage="",this._exportVideoUpdateTimerId=-1,this._enableAndroidVKDetection=!1,this._lastWindowWidth=t._GetWindowInnerWidth(),this._lastWindowHeight=t._GetWindowInnerHeight(),this._virtualKeyboardHeight=0,this._vkTranslateYOffset=0,t.AddRuntimeComponentMessageHandler("runtime","invoke-download",e=>this._OnInvokeDownload(e)),t.AddRuntimeComponentMessageHandler("runtime","load-webfonts",e=>this._OnLoadWebFonts(e)),t.AddRuntimeComponentMessageHandler("runtime","raster-svg-image",e=>this._OnRasterSvgImage(e)),t.AddRuntimeComponentMessageHandler("runtime","get-svg-image-size",e=>this._OnGetSvgImageSize(e)),t.AddRuntimeComponentMessageHandler("runtime","set-target-orientation",e=>this._OnSetTargetOrientation(e)),t.AddRuntimeComponentMessageHandler("runtime","register-sw",()=>this._OnRegisterSW()),t.AddRuntimeComponentMessageHandler("runtime","post-to-debugger",e=>this._OnPostToDebugger(e)),t.AddRuntimeComponentMessageHandler("runtime","go-to-script",e=>this._OnPostToDebugger(e)),t.AddRuntimeComponentMessageHandler("runtime","before-start-ticking",()=>this._OnBeforeStartTicking()),t.AddRuntimeComponentMessageHandler("runtime","debug-highlight",e=>this._OnDebugHighlight(e)),t.AddRuntimeComponentMessageHandler("runtime","enable-device-orientation",()=>this._AttachDeviceOrientationEvent()),t.AddRuntimeComponentMessageHandler("runtime","enable-device-motion",()=>this._AttachDeviceMotionEvent()),t.AddRuntimeComponentMessageHandler("runtime","add-stylesheet",e=>this._OnAddStylesheet(e)),t.AddRuntimeComponentMessageHandler("runtime","script-create-worker",e=>this._OnScriptCreateWorker(e)),t.AddRuntimeComponentMessageHandler("runtime","alert",e=>this._OnAlert(e)),t.AddRuntimeComponentMessageHandler("runtime","screen-reader-text",e=>this._OnScreenReaderTextEvent(e)),t.AddRuntimeComponentMessageHandler("runtime","hide-cordova-splash",()=>this._OnHideCordovaSplash()),t.AddRuntimeComponentMessageHandler("runtime","set-exporting-to-video",e=>this._SetExportingToVideo(e)),t.AddRuntimeComponentMessageHandler("runtime","export-to-video-progress",e=>this._OnExportVideoProgress(e)),t.AddRuntimeComponentMessageHandler("runtime","exported-to-video",e=>this._OnExportedToVideo(e)),t.AddRuntimeComponentMessageHandler("runtime","exported-to-image-sequence",e=>this._OnExportedToImageSequence(e));const n=new Set(["input","textarea","datalist"]);if(window.addEventListener("contextmenu",e=>{const i=e.target,a=i.tagName.toLowerCase();n.has(a)||M(i)||e.preventDefault()}),window.addEventListener("selectstart",f),window.addEventListener("gesturehold",f),window.addEventListener("touchstart",f,{passive:!1}),window.addEventListener("pointerdown",f,{passive:!1}),this._mousePointerLastButtons=0,window.addEventListener("mousedown",e=>{e.button===1&&e.preventDefault()}),window.addEventListener("mousewheel",S,{passive:!1}),window.addEventListener("wheel",S,{passive:!1}),window.addEventListener("resize",()=>this._OnWindowResize()),window.addEventListener("fullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("webkitfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("mozfullscreenchange",()=>this._OnFullscreenChange()),window.addEventListener("fullscreenerror",e=>this._OnFullscreenError(e)),window.addEventListener("webkitfullscreenerror",e=>this._OnFullscreenError(e)),window.addEventListener("mozfullscreenerror",e=>this._OnFullscreenError(e)),t.IsiOSWebView()){let e=1/0;window.visualViewport.addEventListener("resize",()=>{const i=window.visualViewport.height;i>e&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0),e=i}),document.documentElement.setAttribute("ioswebview","")}this._mediaPendingPlay=new Set,this._mediaRemovedPendingPlay=new WeakSet,this._isSilent=!1}_AddDefaultCanvasEventHandlers(t){t.addEventListener("selectstart",f),t.addEventListener("gesturehold",f),t.addEventListener("pointerdown",f)}_AddDefaultHTMLWrapEventHandlers(t){t.addEventListener("selectstart",E),t.addEventListener("gesturehold",E),t.addEventListener("touchstart",E)}_OnBeforeStartTicking(){return self.setTimeout(()=>{this._enableAndroidVKDetection=!0},1e3),this._iRuntime.GetExportType()==="cordova"?(document.addEventListener("pause",()=>this._OnVisibilityChange(!0)),document.addEventListener("resume",()=>this._OnVisibilityChange(!1))):document.addEventListener("visibilitychange",()=>this._OnVisibilityChange(document.visibilityState==="hidden")),this._pageVisibilityIsHidden=!(document.visibilityState!=="hidden"&&!P),{isSuspended:this._pageVisibilityIsHidden}}Attach(){window.addEventListener("focus",()=>this._PostRuntimeEvent("window-focus")),window.addEventListener("blur",()=>{this._PostRuntimeEvent("window-blur",{parentHasFocus:A()}),this._mousePointerLastButtons=0}),window.addEventListener("focusin",n=>{O(n.target)&&this._PostRuntimeEvent("keyboard-blur")}),window.addEventListener("keydown",n=>this._OnKeyEvent("keydown",n)),window.addEventListener("keyup",n=>this._OnKeyEvent("keyup",n)),window.addEventListener("mousedown",n=>this._OnMouseEvent("mousedown",n,c)),window.addEventListener("mousemove",n=>this._OnMouseEvent("mousemove",n,c)),window.addEventListener("mouseup",n=>this._OnMouseEvent("mouseup",n,c)),window.addEventListener("dblclick",n=>this._OnMouseEvent("dblclick",n,s)),window.addEventListener("wheel",n=>this._OnMouseWheelEvent("wheel",n,s)),window.addEventListener("pointerdown",n=>{this._HandlePointerDownFocus(n),this._OnPointerEvent("pointerdown",n)}),this._iRuntime.UsesWorker()&&window.onpointerrawupdate!==void 0&&self===self.top?window.addEventListener("pointerrawupdate",n=>this._OnPointerRawUpdate(n)):window.addEventListener("pointermove",n=>this._OnPointerEvent("pointermove",n)),window.addEventListener("pointerup",n=>this._OnPointerEvent("pointerup",n)),window.addEventListener("pointercancel",n=>this._OnPointerEvent("pointercancel",n));const t=()=>this._PlayPendingMedia();window.addEventListener("pointerup",t,!0),window.addEventListener("touchend",t,!0),window.addEventListener("click",t,!0),window.addEventListener("keydown",t,!0),window.addEventListener("gamepadconnected",t,!0),this._iRuntime.IsAndroid()&&!this._iRuntime.IsAndroidWebView()&&navigator.virtualKeyboard&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.addEventListener("geometrychange",()=>{this._OnAndroidVirtualKeyboardChange(this._GetWindowInnerHeight(),navigator.virtualKeyboard.boundingRect.height)})),this._iRuntime.IsiOSWebView()&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0)}_OnAndroidVirtualKeyboardChange(t,n){if(document.body.style.position="",document.body.style.overflow="",document.body.style.transform="",(this._vkTranslateYOffset=0)<n){const e=document.activeElement;if(e){const i=e.getBoundingClientRect(),a=(i.top+i.bottom)/2,o=(t-n)/2;let d=a-o;0<(d=(d=d>n?n:d)<0?0:d)&&(document.body.style.position="absolute",document.body.style.overflow="visible",document.body.style.transform=`translateY(${-d}px)`,this._vkTranslateYOffset=d)}}}_PostRuntimeEvent(t,n){this.PostToRuntime(t,n||null,p)}_GetWindowInnerWidth(){return this._iRuntime._GetWindowInnerWidth()}_GetWindowInnerHeight(){return this._iRuntime._GetWindowInnerHeight()}_EnableWindowResizeEvent(){this._enableWindowResizeEvent=!0,this._lastWindowWidth=this._iRuntime._GetWindowInnerWidth(),this._lastWindowHeight=this._iRuntime._GetWindowInnerHeight()}_OnWindowResize(){if(!this._isExportToVideo&&this._enableWindowResizeEvent){const t=this._GetWindowInnerWidth(),n=this._GetWindowInnerHeight();if(this._iRuntime.IsAndroidWebView()){if(this._enableAndroidVKDetection){if(this._iRuntime.CanDoAndroidVirtualKeyboardDetection()&&this._lastWindowWidth===t&&n<this._lastWindowHeight)return this._virtualKeyboardHeight=this._lastWindowHeight-n,void this._OnAndroidVirtualKeyboardChange(this._lastWindowHeight,this._virtualKeyboardHeight);0<this._virtualKeyboardHeight&&(this._virtualKeyboardHeight=0,this._OnAndroidVirtualKeyboardChange(n,this._virtualKeyboardHeight))}this._lastWindowWidth=t,this._lastWindowHeight=n}this.PostToRuntime("window-resize",{innerWidth:t,innerHeight:n,devicePixelRatio:window.devicePixelRatio,isFullscreen:y.IsDocumentFullscreen(),cssDisplayMode:this._iRuntime.GetCssDisplayMode()}),this._iRuntime.IsiOSWebView()&&(this._simulatedResizeTimerId!==-1&&clearTimeout(this._simulatedResizeTimerId),this._OnSimulatedResize(t,n,0))}}_ScheduleSimulatedResize(t,n,e){this._simulatedResizeTimerId!==-1&&clearTimeout(this._simulatedResizeTimerId),this._simulatedResizeTimerId=setTimeout(()=>this._OnSimulatedResize(t,n,e),48)}_OnSimulatedResize(t,n,e){const i=this._GetWindowInnerWidth(),a=this._GetWindowInnerHeight();this._simulatedResizeTimerId=-1,i!=t||a!=n?this.PostToRuntime("window-resize",{innerWidth:i,innerHeight:a,devicePixelRatio:window.devicePixelRatio,isFullscreen:y.IsDocumentFullscreen(),cssDisplayMode:this._iRuntime.GetCssDisplayMode()}):e<10&&this._ScheduleSimulatedResize(i,a,e+1)}_OnSetTargetOrientation(t){this._targetOrientation=t.targetOrientation}_TrySetTargetOrientation(){const t=this._targetOrientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(t).catch(n=>console.warn("[Construct] Failed to lock orientation: ",n));else try{let n=!1;screen.lockOrientation?n=screen.lockOrientation(t):screen.webkitLockOrientation?n=screen.webkitLockOrientation(t):screen.mozLockOrientation?n=screen.mozLockOrientation(t):screen.msLockOrientation&&(n=screen.msLockOrientation(t)),n||console.warn("[Construct] Failed to lock orientation")}catch(n){console.warn("[Construct] Failed to lock orientation: ",n)}}_OnFullscreenChange(){if(!this._isExportToVideo){const t=y.IsDocumentFullscreen();t&&this._targetOrientation!=="any"&&this._TrySetTargetOrientation(),this.PostToRuntime("fullscreenchange",{isFullscreen:t,innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}}_OnFullscreenError(t){console.warn("[Construct] Fullscreen request failed: ",t),this.PostToRuntime("fullscreenerror",{isFullscreen:y.IsDocumentFullscreen(),innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnVisibilityChange(t){if(this._pageVisibilityIsHidden!==t&&((this._pageVisibilityIsHidden=t)?this._iRuntime._CancelAnimationFrame():this._iRuntime._RequestAnimationFrame(),this.PostToRuntime("visibilitychange",{hidden:t}),!t)&&this._iRuntime.IsiOSWebView()){const n=()=>{document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0};setTimeout(n,50),setTimeout(n,100),setTimeout(n,250),setTimeout(n,500)}}_OnKeyEvent(t,n){if(n.key!==void 0&&(n.key==="Backspace"&&f(n),this._iRuntime.GetExportType()==="nwjs"&&n.key==="u"&&(n.ctrlKey||n.metaKey)&&n.preventDefault(),!this._isExportToVideo)){const e=r.get(n.code)||n.code;this._PostToRuntimeMaybeSync(t,{code:e,key:n.key,which:n.which,repeat:n.repeat,altKey:n.altKey,ctrlKey:n.ctrlKey,metaKey:n.metaKey,shiftKey:n.shiftKey,timeStamp:n.timeStamp},s)}}_OnMouseWheelEvent(t,n,e){this._isExportToVideo||this.PostToRuntime(t,{clientX:n.clientX,clientY:n.clientY+this._vkTranslateYOffset,pageX:n.pageX,pageY:n.pageY+this._vkTranslateYOffset,deltaX:n.deltaX,deltaY:n.deltaY,deltaZ:n.deltaZ,deltaMode:n.deltaMode,timeStamp:n.timeStamp},e)}_OnMouseEvent(t,n,e){this._isExportToVideo||l(n)||this._PostToRuntimeMaybeSync(t,{button:n.button,buttons:n.buttons,clientX:n.clientX,clientY:n.clientY+this._vkTranslateYOffset,pageX:n.pageX,pageY:n.pageY+this._vkTranslateYOffset,movementX:n.movementX||0,movementY:n.movementY||0,timeStamp:n.timeStamp},e)}_OnPointerEvent(t,n){if(!this._isExportToVideo){let e=0;n.pointerType==="mouse"&&(e=this._mousePointerLastButtons),this._PostToRuntimeMaybeSync(t,{pointerId:n.pointerId,pointerType:n.pointerType,button:n.button,buttons:n.buttons,lastButtons:e,clientX:n.clientX,clientY:n.clientY+this._vkTranslateYOffset,pageX:n.pageX,pageY:n.pageY+this._vkTranslateYOffset,movementX:n.movementX||0,movementY:n.movementY||0,width:n.width||0,height:n.height||0,pressure:n.pressure||0,tangentialPressure:n.tangentialPressure||0,tiltX:n.tiltX||0,tiltY:n.tiltY||0,twist:n.twist||0,timeStamp:n.timeStamp},s),n.pointerType==="mouse"&&(this._mousePointerLastButtons=n.buttons)}}_OnPointerRawUpdate(t){this._OnPointerEvent("pointermove",t)}_OnTouchEvent(t,n){if(!this._isExportToVideo)for(let e=0,i=n.changedTouches.length;e<i;++e){const a=n.changedTouches[e];this._PostToRuntimeMaybeSync(t,{pointerId:a.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:a.clientX,clientY:a.clientY+this._vkTranslateYOffset,pageX:a.pageX,pageY:a.pageY+this._vkTranslateYOffset,movementX:n.movementX||0,movementY:n.movementY||0,width:2*(a.radiusX||a.webkitRadiusX||0),height:2*(a.radiusY||a.webkitRadiusY||0),pressure:a.force||a.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:a.rotationAngle||0,timeStamp:n.timeStamp},s)}}_HandlePointerDownFocus(t){window!==window.top&&window.focus(),this._IsElementCanvasOrDocument(t.target)&&document.activeElement&&!this._IsElementCanvasOrDocument(document.activeElement)&&document.activeElement.blur()}_IsElementCanvasOrDocument(t){return!t||t===document||t===window||t===document.body||t.tagName.toLowerCase()==="canvas"}_AttachDeviceOrientationEvent(){this._attachedDeviceOrientationEvent||(this._attachedDeviceOrientationEvent=!0,window.addEventListener("deviceorientation",t=>this._OnDeviceOrientation(t)),window.addEventListener("deviceorientationabsolute",t=>this._OnDeviceOrientationAbsolute(t)))}_AttachDeviceMotionEvent(){this._attachedDeviceMotionEvent||(this._attachedDeviceMotionEvent=!0,window.addEventListener("devicemotion",t=>this._OnDeviceMotion(t)))}_OnDeviceOrientation(t){this._isExportToVideo||this.PostToRuntime("deviceorientation",{absolute:!!t.absolute,alpha:t.alpha||0,beta:t.beta||0,gamma:t.gamma||0,timeStamp:t.timeStamp,webkitCompassHeading:t.webkitCompassHeading,webkitCompassAccuracy:t.webkitCompassAccuracy},s)}_OnDeviceOrientationAbsolute(t){this._isExportToVideo||this.PostToRuntime("deviceorientationabsolute",{absolute:!!t.absolute,alpha:t.alpha||0,beta:t.beta||0,gamma:t.gamma||0,timeStamp:t.timeStamp},s)}_OnDeviceMotion(t){if(!this._isExportToVideo){let n=null;const e=t.acceleration;e&&(n={x:e.x||0,y:e.y||0,z:e.z||0});let i=null;const a=t.accelerationIncludingGravity;a&&(i={x:a.x||0,y:a.y||0,z:a.z||0});let o=null;const d=t.rotationRate;d&&(o={alpha:d.alpha||0,beta:d.beta||0,gamma:d.gamma||0}),this.PostToRuntime("devicemotion",{acceleration:n,accelerationIncludingGravity:i,rotationRate:o,interval:t.interval,timeStamp:t.timeStamp},s)}}_OnInvokeDownload(t){const n=t.url,e=t.filename,i=document.createElement("a"),a=document.body;i.textContent=e,i.href=n,i.download=e,a.appendChild(i),i.click(),a.removeChild(i)}async _OnLoadWebFonts(t){const n=t.webfonts;await Promise.all(n.map(async e=>{const i=new FontFace(e.name,`url('${e.url}')`);document.fonts.add(i),await i.load()}))}async _OnRasterSvgImage(t){const n=t.blob,e=t.imageWidth,i=t.imageHeight,a=t.surfaceWidth,o=t.surfaceHeight,d=t.imageBitmapOpts,h=await self.C3_RasterSvgImageBlob(n,e,i,a,o);let u;return{imageBitmap:u=d?await createImageBitmap(h,d):await createImageBitmap(h),transferables:[u]}}async _OnGetSvgImageSize(t){return self.C3_GetSvgImageSize(t.blob)}async _OnAddStylesheet(t){await m(t.url)}_PlayPendingMedia(){const t=[...this._mediaPendingPlay];if(this._mediaPendingPlay.clear(),!this._isSilent)for(const n of t){const e=n.play();e&&e.catch(i=>{this._mediaRemovedPendingPlay.has(n)||this._mediaPendingPlay.add(n)})}}TryPlayMedia(t){if(typeof t.play!="function")throw new Error("missing play function");this._mediaRemovedPendingPlay.delete(t);let n;try{n=t.play()}catch{return void this._mediaPendingPlay.add(t)}n&&n.catch(e=>{this._mediaRemovedPendingPlay.has(t)||this._mediaPendingPlay.add(t)})}RemovePendingPlay(t){this._mediaPendingPlay.delete(t),this._mediaRemovedPendingPlay.add(t)}SetSilent(t){this._isSilent=!!t}_OnHideCordovaSplash(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}_OnDebugHighlight(t){if(t.show){this._debugHighlightElem||(this._debugHighlightElem=document.createElement("div"),this._debugHighlightElem.id="inspectOutline",document.body.appendChild(this._debugHighlightElem));const e=this._debugHighlightElem;e.style.display="",e.style.left=t.left-1+"px",e.style.top=t.top-1+"px",e.style.width=t.width+2+"px",e.style.height=t.height+2+"px",e.textContent=t.name}else this._debugHighlightElem&&(this._debugHighlightElem.style.display="none")}_OnRegisterSW(){window.C3_RegisterSW&&window.C3_RegisterSW()}_OnPostToDebugger(t){window.c3_postToMessagePort&&(t.from="runtime",window.c3_postToMessagePort(t))}_InvokeFunctionFromJS(t,n){return this.PostToRuntimeAsync("js-invoke-function",{name:t,params:n})}_OnScriptCreateWorker(t){const n=t.url,e=t.opts,i=t.port2;new Worker(n,e).postMessage({type:"construct-worker-init",port2:i},[i])}_OnAlert(t){alert(t.message)}_OnScreenReaderTextEvent(t){const n=t.type;if(n==="create"){const e=document.createElement("p");e.id="c3-sr-"+t.id,e.textContent=t.text,this._screenReaderTextWrap.appendChild(e)}else if(n==="update"){const e=document.getElementById("c3-sr-"+t.id);e?e.textContent=t.text:console.warn("[Construct] Missing screen reader text with id "+t.id)}else if(n==="release"){const e=document.getElementById("c3-sr-"+t.id);e?e.remove():console.warn("[Construct] Missing screen reader text with id "+t.id)}else console.warn(`[Construct] Unknown screen reader text update '${n}'`)}_SetExportingToVideo(t){this._isExportToVideo=!0;const n=document.createElement("h1");n.id="exportToVideoMessage",n.textContent=t.message,document.body.prepend(n),document.body.classList.add("exportingToVideo"),this.GetRuntimeInterface().GetMainCanvas().style.display="",this._iRuntime.SetIsExportingToVideo(t.duration)}_OnExportVideoProgress(t){this._exportVideoProgressMessage=t.message,this._exportVideoUpdateTimerId===-1&&(this._exportVideoUpdateTimerId=setTimeout(()=>this._DoUpdateExportVideoProgressMessage(),250))}_DoUpdateExportVideoProgressMessage(){this._exportVideoUpdateTimerId=-1;const t=document.getElementById("exportToVideoMessage");t&&(t.textContent=this._exportVideoProgressMessage)}_OnExportedToVideo(t){window.c3_postToMessagePort({type:"exported-video",arrayBuffer:t.arrayBuffer,contentType:t.contentType,time:t.time})}_OnExportedToImageSequence(t){window.c3_postToMessagePort({type:"exported-image-sequence",blobArr:t.blobArr,time:t.time,gif:t.gif})}};y.AddDOMHandlerClass(L)}{const y="dispatchworker.js",l="jobworker.js";self.JobSchedulerDOM=class{constructor(r){this._runtimeInterface=r,this._maxNumWorkers=Math.min(navigator.hardwareConcurrency||2,16),this._dispatchWorker=null,this._jobWorkers=[],this._inputPort=null,this._outputPort=null}async Init(){if(this._hasInitialised)throw new Error("already initialised");this._hasInitialised=!0;const r=this._runtimeInterface.GetScriptFolder()+y,s=(this._dispatchWorker=await this._runtimeInterface.CreateWorker(r,{name:"DispatchWorker"}),new MessageChannel);this._inputPort=s.port1,this._dispatchWorker.postMessage({type:"_init","in-port":s.port2},[s.port2]),this._outputPort=await this._CreateJobWorker()}async _CreateJobWorker(){const r=this._jobWorkers.length,s=this._runtimeInterface.GetScriptFolder()+l,c=await this._runtimeInterface.CreateWorker(s,{name:"JobWorker"+r}),p=new MessageChannel,m=new MessageChannel;return this._dispatchWorker.postMessage({type:"_addJobWorker",port:p.port1},[p.port1]),c.postMessage({type:"init",number:r,"dispatch-port":p.port2,"output-port":m.port2},[p.port2,m.port2]),this._jobWorkers.push(c),m.port1}GetPortData(){return{inputPort:this._inputPort,outputPort:this._outputPort,maxNumWorkers:this._maxNumWorkers}}GetPortTransferables(){return[this._inputPort,this._outputPort]}}}{const y="touch",l=class extends self.DOMHandler{constructor(r){super(r,y),this.AddRuntimeMessageHandler("request-permission",s=>this._OnRequestPermission(s))}async _OnRequestPermission(r){const s=r.type;let c=!0;s===0?c=await this._RequestOrientationPermission():s===1&&(c=await this._RequestMotionPermission()),this.PostToRuntime("permission-result",{type:s,result:c})}async _RequestOrientationPermission(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;try{return await self.DeviceOrientationEvent.requestPermission()==="granted"}catch(r){return console.warn("[Touch] Failed to request orientation permission: ",r),!1}}async _RequestMotionPermission(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return await self.DeviceMotionEvent.requestPermission()==="granted"}catch(r){return console.warn("[Touch] Failed to request motion permission: ",r),!1}}};self.RuntimeInterface.AddDOMHandlerClass(l)}{const y="googleplay",l=class extends self.DOMHandler{constructor(r){super(r,y),this.AddRuntimeMessageHandlers([["load",([s])=>this._Load(s)],["signin",()=>this._SignIn()],["signout",()=>this._SignOut()],["getplayer",()=>this._RequestPlayerDetails()],["submitscore",s=>this._SubmitScore(s)],["requestscores",s=>this._RequestHiScores(s)],["requestachievements",s=>this._RequestAchievements(s)],["requestmetadata",s=>this._RequestAchievementMetaData(s)],["reveal",s=>this._RevealAchievement(s)],["unlock",s=>this._UnlockAchievement(s)],["increment",s=>this._IncrementAchievement(s)],["setsteps",s=>this._SetSteps(s)],["showleaderboard",s=>this._ShowLeaderboard(s)],["showachievements",s=>this._ShowAchievements(s)]]),this._playinterface=null,this._isSignedIn=!1,this._isLoaded=!1}async _RequestPlayerDetails(){if(!this._isSignedIn)return null;const r={id:"",display:"",avatar:"",givenName:"",familyName:""};let s;return s=window.cordova?await this._CallNativeAPIMethod("getPlayerData"):await this._CallWebAPIMethod("players/me"),r.id=s.playerId||"",r.display=s.displayName||"",r.avatar=s.avatarImageUrl||"",s.name&&(r.givenName=s.name.givenName||"",r.familyName=s.name.familyName||""),r}_SignIn(){if(!this._isLoaded||this._isSignedIn)return null;this.playInterface?this.playInterface.signin():self.gapi.auth.signIn({callback:window.googlePlaySigninCallback})}_SignOut(){if(!this._isSignedIn)return null;this.playInterface?this.playInterface.signout():self.gapi.auth.signOut()}_SubmitScore(r){if(!this._isSignedIn)return null;if(this.playInterface)return this._CallNativeAPIMethod("submitScore",r);{const s=r.leaderboardId;return this._CallWebAPIMethod(`leaderboards/${s}/scores`,r,"post")}}async _RequestHiScores(r){if(!this._isSignedIn)return null;const s={page:[],total:0,best:0,formattedbest:"",besttag:"",rank:0,formattedrank:""};let c;if(this.playInterface)c=await this._CallNativeAPIMethod("getHiScores",r);else{const p=r.leaderboardId,m=r.collection,_=r.type;c=await this._CallWebAPIMethod(`leaderboards/${p}/${_}/`+m,r)}return s.total=parseInt(c.numScores,10)||0,c.playerScore&&(s.best=parseInt(c.playerScore.scoreValue,10)||0,s.formattedbest=c.playerScore.formattedScore||"",s.besttag=c.playerScore.scoreTag||"",s.rank=parseInt(c.playerScore.scoreRank,10)||0,s.formattedrank=c.playerScore.formattedScoreRank||""),s.page=c.items,s}async _RequestAchievements(r){const s=r.which;if(!this._isSignedIn)return null;if(this.playInterface){const c=await this._CallNativeAPIMethod("getAchievements",r),p=new Map,m=c.items;for(const _ of c.items)p.set(_.id,{name:_.name,description:_.description,type:_.achievementType,totalSteps:_.totalSteps,revealedUrl:_.revealedIconUrl,unlockedUrl:_.unlockedIconUrl});return{page:m.filter(_=>_.state===s),id:p}}return{page:(await this._CallWebAPIMethod("players/me/achievements",r)).items.filter(p=>p.state===s),id:null}}async _RequestAchievementMetaData(r){const s=r.reload;if(!this._isSignedIn)return null;if(this.playInterface)return this._RequestAchievements({which:"ALL",reload:s});{const c=await this._CallWebAPIMethod("achievements"),p=new Map;for(const m of c.items)p.set(m.id,{name:m.name,description:m.description,type:m.achievementType,totalSteps:m.totalSteps,revealedUrl:m.revealedIconUrl,unlockedUrl:m.unlockedIconUrl});return{page:null,id:p}}}async _RevealAchievement(r){const s=r.id;return this._isSignedIn?(this.playInterface?await this._CallNativeAPIMethod("revealAchievement",{achievementId:s}):await this._CallWebAPIMethod(`achievements/${s}/reveal`,null,"post"),!0):null}async _UnlockAchievement(r){const s=r.id;return this._isSignedIn?(this.playInterface?await this._CallNativeAPIMethod("unlockAchievement",{achievementId:s}):await this._CallWebAPIMethod(`achievements/${s}/unlock`,null,"post"),!0):null}async _IncrementAchievement(r){const s=r.id,c=r.steps;return this._isSignedIn?(this.playInterface?await this._CallNativeAPIMethod("incrementAchievement",{achievementId:s,numSteps:c}):await this._CallWebAPIMethod(`achievements/${s}/increment`,{stepsToIncrement:c},"post"),!0):null}async _SetSteps(r){const s=r.id,c=r.steps;return this._isSignedIn?(this.playInterface?await this._CallNativeAPIMethod("setStepsAchievement",{achievementId:s,numSteps:c}):await this._CallWebAPIMethod(`achievements/${s}/setStepsAtLeast`,{steps:c},"post"),!0):null}_ShowLeaderboard(r){const s=r.id;if(!this._isSignedIn)return null;if(this.playInterface)return s!=null?this._CallNativeAPIMethod("showLeaderboard",{leaderboardId:s}):this._CallNativeAPIMethod("showLeaderboards");throw new Error("not available")}_ShowAchievements(){if(!this._isSignedIn)return null;if(this.playInterface)return this._CallNativeAPIMethod("showAchievements");throw new Error("not available")}_CallWebAPIMethod(r,s=void 0,c="get"){return new Promise((p,m)=>{self.gapi.client.request({path:"/games/v1/"+r,method:c,params:s,callback:function(_){let v=_?_.error:"no_response";v?(typeof v=="object"?v=typeof v.message=="string"?v.message:"unknown":typeof v!="string"&&(v="unknown"),m(v)):p(_)}})})}_CallNativeAPIMethod(r,s={}){return new Promise((c,p)=>{this.playInterface[r](s,(m,_)=>{m?p(m):c(_)})})}_Load(r){return new Promise((s,c)=>{const p=(m,_)=>{this._isSignedIn=_,this.PostToRuntime("login",{state:_,error:m})};window.cordova?this._LoadCordovaAPI(s,c,p):this._LoadWebAPI(r,s,c,p)})}_LoadWebAPI(r,s,c,p){const m=(v,M)=>{const C=document.createElement("meta");C.setAttribute("name","google-signin-"+v),C.setAttribute("content",M),document.head.appendChild(C)},_=(window.googlePlayLoadCallback=(...v)=>{this._isLoaded=!0,s(...v)},window.googlePlaySigninCallback=v=>{v.status&&v.status.signed_in?p("",!0):p(v.error+"",!1)},m("clientid",r),m("cookiepolicy","single_host_origin"),m("callback","googlePlaySigninCallback"),m("scope","https://www.googleapis.com/auth/games"),document.createElement("script"));_.setAttribute("type","text/javascript"),_.setAttribute("async",""),_.setAttribute("src","https://apis.google.com/js/client.js?onload=googlePlayLoadCallback"),_.addEventListener("error",()=>c("failed to load script")),document.head.appendChild(_)}_LoadCordovaAPI(r,s,c){const p=window.cordova.plugins.ConstructPlayGames;if(!p)return s();this.playInterface=p,r(),this._isLoaded=!0,p.setCallback(c),p.silentSignIn()}};self.RuntimeInterface.AddDOMHandlerClass(l)}window.C3_Is_Supported&&(window.c3_runtimeInterface=new self.RuntimeInterface({useWorker:!1,workerMainUrl:"workermain.js",runtimeScriptList:["scripts/c3main.js"],scriptFolder:"scripts/",exportType:"html5"}));
