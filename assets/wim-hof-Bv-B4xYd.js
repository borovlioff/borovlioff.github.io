import"./modulepreload-polyfill-B5Qt9EMX.js";class B{constructor(){this.audioContext=null,this.oscillator=null}async init(){this.audioContext||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),await this.audioContext.resume())}playBeep(t=440,e=.1,a=.3){if(!this.audioContext)return;const n=this.audioContext.createOscillator(),o=this.audioContext.createGain();n.type="sine",n.frequency.setValueAtTime(t,this.audioContext.currentTime),o.gain.setValueAtTime(a,this.audioContext.currentTime),o.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+e),n.connect(o),o.connect(this.audioContext.destination),n.start(),n.stop(this.audioContext.currentTime+e)}playBreathSound(){if(!this.audioContext)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.type="triangle",t.frequency.setValueAtTime(300,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(200,this.audioContext.currentTime+.15),e.gain.setValueAtTime(.15,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.2),t.connect(e),e.connect(this.audioContext.destination),t.start(),t.stop(this.audioContext.currentTime+.2)}}const h=new B;h.init();class A{constructor(){this.startData=Date.now(),this.currentData=Date.now()}getTime(){const t=Date.now(),e=Math.floor((t-this.startData)/1e3),a=Math.floor((t-this.currentData)/1e3);return this.currentData=t,[e,a]}waitUntil(t,e=100,a=()=>{}){return new Promise(n=>{const o=setInterval(()=>{if(i||l){clearInterval(o),n(Date.now());return}const c=Date.now();a(c),c>=t&&(clearInterval(o),n(c))},e)})}sleep(t){const e=Date.now()+t;return this.waitUntil(e,50)}}const I=new A,p=document.getElementById("welcome-screen"),w=document.getElementById("session-screen"),D=document.getElementById("start-btn"),S=document.getElementById("stop-btn"),R=document.getElementById("pause-btn"),H=document.getElementById("pause-icon"),g=document.getElementById("stage-text"),d=document.getElementById("counter"),N=document.getElementById("round-info"),u=document.getElementById("breath-animation"),m=document.getElementById("animation-text"),s=document.getElementById("next-btn"),k=document.getElementById("rounds"),M=document.getElementById("breathCount"),_=document.getElementById("holdAfterExhaleSec"),G=document.getElementById("holdAfterInhaleSec");let C=3,x=35,E=120,v=15,y=1,l=!1,i=!1;const b={BREATHING:"breathing",HOLD_AFTER_EXHALE:"hold-after-exhale",HOLD_AFTER_INHALE:"hold-after-inhale"};let f=null;D.addEventListener("click",async()=>{C=parseInt(k.value)||3,x=parseInt(M.value)||35,E=parseInt(_.value)||120,v=parseInt(G.value)||15,p.classList.add("opacity-0"),await I.waitUntil(Date.now()+500),p.classList.add("hidden"),w.classList.remove("hidden"),w.classList.remove("opacity-0"),V()});S.addEventListener("click",T);R.addEventListener("click",P);function P(){!f||i||(l=!l,H.textContent=l?"▶️":"⏸️")}function T(){i=!0,l=!1,f=null,w.classList.add("opacity-0"),setTimeout(()=>{w.classList.add("hidden"),p.classList.remove("hidden"),p.classList.remove("opacity-0"),i=!1},500)}async function V(){i=!1,l=!1,y=1,await L()}async function L(){i||(await j(),!i&&(await F(E),!i&&(await O(v),y++,y<=C&&!i?(await I.sleep(2e3),await L()):i||U())))}async function j(){f=b.BREATHING;let r=0;const t=1200,e=Date.now();return g.textContent="Глубокие вдохи",N.textContent=`Круг ${y}/${C}`,d.textContent="0",new Promise(a=>{const n=setInterval(()=>{if(i)return clearInterval(n),a();if(l)return;const o=Date.now()-e,c=Math.floor(o/t);c!==r&&c<x&&(r=c,d.textContent=r+1,r%2===0?(u.className="w-40 h-40 md:w-60 md:h-60 rounded-full bg-white bg-opacity-20 border-4 border-blue-300 flex items-center justify-center scale-110 transition-transform duration-300",m.textContent="Вдох",h.playBreathSound()):(u.className="w-40 h-40 md:w-60 md:h-60 rounded-full bg-white bg-opacity-20 border-4 border-gray-400 flex items-center justify-center scale-95 transition-transform duration-300",m.textContent="Выдох")),r>=x-1&&(clearInterval(n),d.textContent=x.toString(),u.className="w-40 h-40 md:w-60 md:h-60 rounded-full bg-white bg-opacity-10 border-4 border-red-500 border-opacity-60 flex items-center justify-center scale-95",m.textContent="Выдохните...",h.playBeep(600,.2),a())},100)})}async function F(r=120){f=b.HOLD_AFTER_EXHALE;let t=0;const e=Date.now();let a=!1;return g.textContent="Задержка дыхания",m.textContent="Выдохните...",u.className="w-40 h-40 md:w-60 md:h-60 rounded-full bg-white bg-opacity-10 border-4 border-red-500 border-opacity-60 flex items-center justify-center scale-95",s.classList.add("hidden","opacity-0"),s.classList.remove("opacity-100"),new Promise(n=>{const o=()=>{s.removeEventListener("click",o),s.classList.add("hidden"),h.playBeep(500,.3),clearInterval(c),n()};s.addEventListener("click",o);const c=setInterval(()=>{if(i)return clearInterval(c),s.removeEventListener("click",o),s.classList.add("hidden"),n();l||(t=Math.floor((Date.now()-e)/1e3),d.textContent=t,!a&&t>=5&&(a=!0,s.classList.remove("hidden"),s.offsetWidth,s.classList.remove("opacity-0"),s.classList.add("opacity-100")),t>=r&&(clearInterval(c),s.removeEventListener("click",o),s.classList.add("hidden"),h.playBeep(500,.3),n()))},100)})}async function O(r=15){f=b.HOLD_AFTER_INHALE;let t=r;const e=Date.now()+r*1e3;return g.textContent="Задержка после вдоха",u.className="w-40 h-40 md:w-60 md:h-60 rounded-full bg-gradient-to-br from-blue-400 to-cyan-500 border-4 border-blue-300 flex items-center justify-center scale-110 animate-pulse",m.textContent="Дышите...",new Promise(a=>{const n=setInterval(()=>{if(i)return clearInterval(n),a();l||(t=Math.max(0,Math.ceil((e-Date.now())/1e3)),d.textContent=t,t===0&&(clearInterval(n),h.playBeep(700,.4),a()))},100)})}function U(){f=null,g.textContent="Сессия завершена",d.textContent="✅",m.textContent="Отдохните",u.className="w-40 h-40 md:w-60 md:h-60 rounded-full bg-green-500 bg-opacity-30 border-4 border-green-400 flex items-center justify-center",I.waitUntil(Date.now()+3e3).then(()=>{i||T()})}
